<div *ngIf="visible" class="patient-banner position-relative bg-light border rounded shadow-sm p-1">
  <!-- Close -->
  <button
    class="btn-close position-absolute banner-close m-1" style="height: 2px; width: 8px;"
    (click)="closeBanner()"
    aria-label="Close">
  </button>

  <!-- Content -->
  <div class="d-flex align-items-center gap-2">
    <!-- Avatar -->
    <div class="avatar flex-shrink-0">
      <img
        [src]="patientInfo?.patientPicture ? 'data:image/jpeg;base64,' + patientInfo.patientPicture : 'assets/images/patient.jpg'"
        alt="Patient"
        class="rounded-circle"
        style="object-fit: cover; height: 50px; width: 50px" />
    </div>

    <!-- Name + details -->
    <div class="me-1">
      <div class="banner-name fw-semibold d-flex align-items-center gap-1">
        <span>{{ patientInfo?.personFirstName || 'Asma Othman Al Hammadi' }}</span>
        <span *ngIf="patientInfo?.vipPatient" class="text-warning">â˜…</span>
      </div>
  <div class="details small mt-1">
  <div class=" d-flex align-items-center">
  <span class="me-1" style="font-size: 12px;"><b>{{ 'MR_NO' | translate }} {{ patientInfo?.mrNo || 'n/a' }} </b></span>
        <span class="d-flex align-items-center me-1" style="font-size: 12px;">
          <!-- <i class="bi bi-calendar-date me-1"></i> -->
          <span class="me-1 ms-1"> | </span> {{ patientInfo?.patientBirthDate ? (patientInfo.patientBirthDate | date: "dd/MM/yyyy h:mm a") : 'n/a' }}
          <span class="mx-1 sep">({{ ((patientInfo?.age || '').split(' ')[0]) || 'n/a' }} y)</span>
          <span>{{ patientInfo?.personSex || 'n/a' }}</span>
        </span>
        <span class="d-flex align-items-center me-1" style="font-size: 12px;">
          <span class="me-1"> | </span><ng-icon style="color: orange; margin-bottom: 2px;" class="me-1 ms-1" name="tablerPhone"></ng-icon>
          {{ patientInfo?.personCellPhone || '(555) 123-4567' }}
        </span>
        </div>
      </div>
      <div class="details small" style="margin-top: 2px;">
        <span class="d-flex align-items-center" style="font-size: 12px;">
          <ng-icon style="color: orange" class="me-1 ms-1" name="tablerMail"></ng-icon>
          {{ patientInfo?.personEmail || 'example@gmail.com' }}
        </span>
      </div>
    </div> 
    <div class="flex-grow-1 d-flex">
          <div class="px-2 border-start details small mt-1">
            <div style="font-size: 12px; margin-bottom: 3px;"><strong>{{ 'PAYER' | translate }}:</strong> {{ insuranceInfo[0]?.payerName || 'n/a' }}</div>
            <div style="margin-top: 2px; font-size: 12px; margin-bottom: 3px;"><strong>{{ 'PLAN' | translate }}:</strong> {{ insuranceInfo[0]?.plan || 'n/a' }}</div>
              <div style="margin-top: 2px; font-size: 12px;"><strong>{{ 'MEMBER_ID' | translate }}:</strong> {{ insuranceInfo[0]?.memberId || 'n/a' }}</div>
          </div>
      
          <div class="px-2 border-start details small mt-1">
            <div style="font-size: 12px; margin-bottom: 3px;"><strong>{{ 'PCP' | translate }}:</strong> {{ patientInfo?.pcpName || 'Dr. Amanda Blake' }}</div>
            <div style="margin-top: 2px; font-size: 12px; margin-bottom: 3px;"><strong>{{ 'PATIENT_TYPE' | translate }}:</strong> {{ patientInfo?.patientType || 'Outpatient' }}</div>
            <div style="margin-top: 2px; font-size: 12px;"><strong>{{ 'POD_TYPE' | translate }}:</strong> {{ patientInfo?.podType || 'Primary Care' }}</div>
            </div>

             <!-- Right-aligned info badge -->
             <!-- *ngIf="visitAppointments?.appointmentId" -->
          <div class="px-2 border-start d-none d-lg-block" >
            <div class="info-badge info-badge-wide">
              <div class="badge-title text-uppercase"> {{ 'VISIT_INFO' | translate }}  </div>
              <div class="d-flex align-items-start justify-content-between gap-2">
                <div class="me-2">
                        <div class="badge-value small"><strong>{{ visitAppointments?.fullName || (('PROVIDER' | translate) + ' : N/A') }}</strong></div>
                        <div class="badge-date small"><strong>{{ visitAppointments?.appDateTime ? (visitAppointments.appDateTime | date: "dd/MM/yyyy h:mm a") : (('DATE' | translate) + ' : N/A') }}</strong></div>
                        <!-- <div class="badge-value small"><strong>{{ visitAppointments?.fullName || 'Provider: N/A' }}</strong></div>
                        <div class="badge-date small"><strong>{{ visitAppointments?.appDateTime || 'Date: N/A' | date:'MMM d, y h:mm a' }}</strong></div> -->
                      </div>
                <button type="button" class="btn btn-link p-0 m-0 mt-1" (click)="searchAppointment(patientInfo?.mrNo, appointmentModal)" aria-label="Search appointment" *ngIf="visitAppointments?.appointmentId">
                  <ng-icon [ngbTooltip]="('SWITCH_VISIT' | translate)" tooltipClass="tooltip-allergy" placement="bottom" style="color: orange; height: 16px; width: 16px;" name="tablerUser-search"></ng-icon>
                </button>
              </div>
            </div>
          </div>
          
          <div class="px-2 border-start details small mt-1">
            <!-- ngbTooltip="Patient alerts present" tooltipClass="tooltip-sm" placement="bottom" -->
            <div>
              <span class="me-1">
                <svg class="kda-blink" 
                     xmlns="http://www.w3.org/2000/svg" height="16px" fill="orange" viewBox="0 -960 960 960" width="16px">
                  <path d="M440-360h80v-80h80v-80h-80v-80h-80v80h-80v80h80v80ZM160-200v-80h80v-280q0-83 50-147.5T420-792v-28q0-25 17.5-42.5T480-880q25 0 42.5 17.5T540-820v28q80 20 130 84.5T720-560v280h80v80H160Zm320-300Zm0 420q-33 0-56.5-23.5T400-160h160q0 33-23.5 56.5T480-80ZM320-280h320v-280q0-66-47-113t-113-47q-66 0-113 47t-47 113v280Z"/>
                </svg>
              </span>
              <strong class="kda-blink kda-text">{{ 'ALERT' | translate }}</strong>
          </div>
            <div [ngbTooltip]="allergyTooltip" tooltipClass="tooltip-allergy" placement="bottom">
              <span class="me-1">
                <svg class="kda-blink" 
                     xmlns="http://www.w3.org/2000/svg" height="16px" viewBox="0 -960 960 960" width="16px" fill="orange">
                  <path d="M450-80q-12 0-21-9t-9-21q0-12 9-21t21-9v-62q-42-5-79-20t-67-40l-43 44q9 9 9 21t-9 21q-9 9-21 9t-21-9l-43-42q-9-9-9-21.5t9-21.5q9-9 21-8.5t21 8.5l44-44q-25-31-40-67t-20-78h-62q0 12-9 21t-21 9q-12 0-21-9t-9-21v-60q0-12 9-21t21-9q12 0 21 9t9 21h62q5-42 20.5-78t39.5-67l-44-44q-9 8-21 8.5t-21-8.5q-9-9-9-21.5t9-21.5l42-42q9-9 21.5-9t21.5 9q9 9 9 21.5t-9 21.5l43 43q31-25 67-40t78-20v-62q-12 0-20.5-9t-8.5-21q0-12 9-21t21-9h60q12 0 21 9t9 21q0 12-9 21t-21 9v62q42 5 78 20t67 40l44-44q-9-9-9-21t9-21q9-9 21.5-9t21.5 9l42 43q9 9 9 21t-9 21q-9 9-21.5 9t-21.5-9l-43 43q25 31 40 67.5t20 78.5h62q0-12 9-21t21-9q12 0 21 9t9 21v60q0 12-9 21t-21 9q-12 0-21-9t-9-21h-62q-5 42-20 78.5T698-304l43 43q9-9 21.5-9t21.5 9q9 9 9 21.5t-9 21.5l-42 42q-9 9-21.5 9t-21.5-9q-9-9-8.5-21t8.5-21l-44-44q-31 25-67 40.5T510-201v61q12 0 21 9t9 21q0 12-9 21t-21 9h-60Zm30-200q83 0 141.5-58.5T680-386q-5-30-22.5-54T650-478l-66-34q-23-12-41.5-30.5T512-584l-34-66q-16-32-46-51t-66-19q-58 0-95.5 44T242-574q5 30 22.5 54t45.5 38l66 34q23 12 41.5 30.5T448-376l34 66q16 32 46 51t66 19ZM380-540q25 0 42.5-17.5T440-600q0-25-17.5-42.5T380-660q-25 0-42.5 17.5T320-600q0 25 17.5 42.5T380-540Zm200 250q21 0 35.5-14.5T630-340q0-21-14.5-35.5T580-390q-21 0-35.5 14.5T530-340q0 21 14.5 35.5T580-290ZM480-480Z"/>
              </svg>
              </span>
              <strong class="kda-blink kda-text"> {{ 'ALLERGIES' | translate }}</strong> 
          </div>
        <div [ngbTooltip]="KDAstatus" tooltipClass="tooltip-allergy" placement="bottom">
          <span class="me-1">
          <svg class="kda-blink" 
               xmlns="http://www.w3.org/2000/svg" height="16px" viewBox="0 -960 960 960" width="16px" fill="orange">
            <path d="M600-80q-17 0-28.5-11.5T560-120v-43q-23-4-43.5-11.5T478-195l-40 40q-12 11-28.5 11.5T381-155q-12-12-12-28.5t12-28.5l41-41q-3-5-6-10.5t-6-10.5l-27-53-49 49q-12 11-28 11.5T278-278q-12-12-12-28t12-28l49-50-53-26q-5-2-9-4.5t-9-5.5l-36 36q-12 11-28.5 11.5T163-384q-12-12-12-28t12-28l35-35q-14-19-22.5-40.5T163-560h-43q-17 0-28.5-11.5T80-600q0-17 11.5-28.5T120-640h45q5-19 12-36t18-33l-35-35q-12-12-12-28t12-28q12-12 28-12t28 12l35 35q16-11 33-18t36-12v-45q0-17 11.5-28.5T360-880q17 0 28.5 11.5T400-840v43q24 4 45.5 13t40.5 23l35-35q12-12 28.5-12t28.5 12q12 12 12 28.5T678-625l-48 47 56 28q6 3 12.5 6.5T710-536l40-40q12-12 28-12t28 12q12 12 12 28.5T806-519l-40 39q12 18 19.5 38t11.5 42h43q17 0 28.5 11.5T880-360q0 17-11.5 28.5T840-320h-45q-5 19-12 35.5T765-252l34 34q12 12 12 28.5T799-161q-12 11-28.5 11.5T742-161l-33-34q-16 11-33 18t-36 12v45q0 17-11.5 28.5T600-80Zm-6-160q58 0 95.5-44T718-386q-5-30-22.5-54T650-478l-66-34q-23-12-41.5-30.5T512-584l-34-66q-16-32-46-51t-66-19q-58 0-95.5 44T242-574q5 30 22.5 54t45.5 38l66 34q23 12 41.5 30.5T448-376l34 66q16 32 46 51t66 19ZM380-540q25 0 42.5-17.5T440-600q0-25-17.5-42.5T380-660q-25 0-42.5 17.5T320-600q0 25 17.5 42.5T380-540Zm200 250q21 0 35.5-14.5T630-340q0-21-14.5-35.5T580-390q-21 0-35.5 14.5T530-340q0 21 14.5 35.5T580-290ZM480-480Z"/>
          </svg>
          </span>
          <strong class="kda-blink kda-text">{{ 'KDA' | translate }} </strong>   
        </div>
            
      </div>
          
          <div class="px-2 border-start details small mt-1">
            <div>
              <span class="me-1">
                <svg  xmlns="http://www.w3.org/2000/svg" height="16px" viewBox="0 -960 960 960" width="16px" fill="orange">
                <path d="M720-720q-33 0-56.5-23.5T640-800q0-33 23.5-56.5T720-880q33 0 56.5 23.5T800-800q0 33-23.5 56.5T720-720ZM680-80v-320q0-40-20.5-72T607-522l35-103q8-25 29.5-40t48.5-15q27 0 48.5 15t29.5 40l102 305H800v240H680ZM500-500q-25 0-42.5-17.5T440-560q0-25 17.5-42.5T500-620q25 0 42.5 17.5T560-560q0 25-17.5 42.5T500-500ZM220-720q-33 0-56.5-23.5T140-800q0-33 23.5-56.5T220-880q33 0 56.5 23.5T300-800q0 33-23.5 56.5T220-720ZM140-80v-280H80v-240q0-33 23.5-56.5T160-680h120q33 0 56.5 23.5T360-600v240h-60v280H140Zm300 0v-160h-40v-160q0-25 17.5-42.5T460-460h80q25 0 42.5 17.5T600-400v160h-40v160H440Z"/>
              </svg>
              </span>
              <strong> {{ 'FAMILY' | translate }}</strong>
              </div>    
          </div>
          
         
      </div>
    </div>
  </div>

<!-- Tooltip template for Allergies icon -->
<ng-template #allergyTooltip>
  <div class="tooltip-allergy-content">
    <div><strong>Other Allergies:</strong></div>
    <hr class="my-1">
    <div>Food Allergy</div>
    <hr class="my-1">
    <div>Choclate</div>
  </div>
  <!-- For dynamic data later, bind an array and ngFor here -->
</ng-template>


<!-- Tooltip template for Allergies icon -->
<ng-template #KDAstatus>
  <div class="tooltip-allergy-content">
    <div><strong>Known Drug Allergies:</strong></div>
    <hr class="my-1">
    <div>Panadol</div>
  </div>
  <!-- For dynamic data later, bind an array and ngFor here -->
</ng-template>



 <!-- Appointment Modal -->
 <ng-template #appointmentModal let-modal>
  <div class="modal-header  bg-light">
    <h5 [class.text-start]="!isRtl" [class.text-end]="isRtl" class="modal-title" id="cancelAppointmentLabel">{{ 'VISITS' | translate }}</h5>
    <button type="button" class="btn-close" (click)="modal.dismiss()" 
    [class.order-first]="isRtl" [class.ms-auto]="!isRtl"></button>
  </div>
 

  <div class="modal-body">
    <div class="table-responsive" style="height: 500px; overflow-y: auto;">
      <table class="table align-middle mb-0">
        <thead class="align-middle thead-sm">
          <tr>
            <th>{{ 'SNO' | translate }}</th>
            <th>{{ 'VISIT_ACCOUNT_NO' | translate }}</th>
            <th>{{ 'NAME' | translate }}</th>
            <th>{{ 'PROVIDER' | translate }}</th>
            <th>{{ 'SITE' | translate }}</th>
            <th>{{ 'PURPOSE' | translate }}</th>
            <th>{{ 'STATUS' | translate }}</th>
            <th>{{ 'DURATION' | translate }}</th>
            <th>{{ 'DATE' | translate }}</th>
            <th>{{ 'ACTION' | translate }}</th>
          </tr>
        </thead>
        <tbody class="table-group-divider">
          <tr *ngFor="let Data of paginatedAppointments ; let i = index" [ngClass]="{ 'high-rated': Data?.appointmentId === ActiveAppoinment }">

            <td>
              {{ ((currentPage - 1) * pageSize) + i + 1 }}
            </td>
            <td>
              <span class="ml-1 vertical-align-middle">{{Data.visitAccDisplay || 'N/A'}}</span>
            </td>
            <td>
              <span>{{Data.patientFullName || 'N/A'}}</span>
            </td>
            <td>
              <span>{{Data.fullName || 'N/A'}}</span>
            </td>
            <td>
              <span>{{Data.siteName || 'N/A'}}</span>
            </td>
            <td>
              <span>{{Data.duration || 'N/A'}} Min</span>
              <span>{{Data.purposeOfVisit || 'N/A'}}</span>
            </td>
            <td>
              <span>{{Data.appStatus || 'N/A'}}</span>
            </td>
            <td>
              <span>{{Data.duration || 'N/A'}}</span>
            </td>
            <td>
              <span>{{Data.appDateTime | date: "dd/MM/yyyy h:mm a"}}</span>
            </td>
            <td class="text-center">
              <ng-icon 
              [ngbTooltip]="('LOAD_APPOINTMENT' | translate)" tooltipClass="tooltip-allergy" placement="bottom" 
              (click)="appointmentLoad(Data)"  style="color: orange ;cursor: pointer; height: 16px; width: 16px;"
              name="tablerRotateClockwise2"></ng-icon>
            </td>
          </tr>

          <tr *ngIf="AppoinmentData.length === 0">
            <td colspan="8">{{ 'NO_DATA_FOUND' | translate }}</td>
          </tr>
        </tbody>
      </table>
    </div>
    <!-- Pagination -->
    <div class="d-flex justify-content-end mt-2">
      <nav>
        <ul class="pagination pagination-sm mb-0">
          <li class="page-item" [class.disabled]="currentPage === 1">
            <button class="page-link" (click)="prevPage()" [disabled]="currentPage === 1">Previous</button>
          </li>
          <li class="page-item" *ngFor="let page of pageNumbers" [class.active]="page === currentPage">
            <button class="page-link" (click)="goToPage(page)">{{ page }}</button>
          </li>
          <li class="page-item" [class.disabled]="currentPage === totalPages">
            <button class="page-link" (click)="nextPage()" [disabled]="currentPage === totalPages">Next</button>
          </li>
        </ul>
      </nav>
    </div>
  </div>

  <div class="modal-footer">
    <button type="button" class="btn btn-warning" (click)="modal.dismiss()">Close</button>
    <!-- <button type="button" class="btn btn-danger" (click)="cancelApp()">Cancel Appointment</button> -->
  </div>
</ng-template>