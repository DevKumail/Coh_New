<div class="basic-form" [formGroup]="basicForm">
  <div class="row">
    <!-- ========== TOP SIDE START ========== -->
        <div class="col-md-3">
          <div class="form-group mb-2">
            <label for="date">Date</label>
            <input type="date" class="form-control" id="date" formControlName="date" placeholder="Select date">
          </div>
        </div>
        <div class="col-md-3">
          <div class="form-group mb-2">
            <label for="attendingClinician">Attending clinician</label>
            <select class="form-select" id="attendingClinician" formControlName="attendingClinician">
              <option value="" disabled selected>Select clinician</option>
              <option *ngFor="let p of hrEmployees" [value]="p.providerId">{{ p.name }}</option>
            </select>
          </div>
        </div>

        <div class="col-md-3">
          <div class="form-group mb-2">
            <label for="adiposity">Adiposity</label>
            <select class="form-select" id="adiposity" formControlName="adiposity">
              <option value="" disabled selected>Select adiposity</option>
              <option *ngFor="let o of opts('IVFFertilityHistory:Adiposity')" [value]="o.valueId">{{ o.name }}</option>
            </select>
          </div>
        </div>
        <div class="col-md-3">
          <div class="form-group mb-2">
            <label for="generallyHealthy">Generally healthy</label>
            <select class="form-select" id="generallyHealthy" formControlName="generallyHealthy">
              <option value="" disabled selected>Select option</option>
              <option *ngFor="let o of opts('IVFFertilityHistory:GenerallyHealthy')" [value]="o.valueId">{{ o.name }}</option>
            </select>
          </div>
        </div>
        <div class="col-md-3">
          <div class="form-group mb-2">
            <label for="longTermMedication">Long-term medication</label>
            <input type="text" class="form-control" id="longTermMedication" formControlName="longTermMedication" placeholder="Enter medication">
          </div>
        </div>

        <div class="col-md-3">
          <div class="form-group mb-2">
            <label for="pregnanciesAchieved"># of pregnancies achieved</label>
        <div class="input-group">
          <input type="number" class="form-control" id="pregnanciesAchieved" formControlName="pregnanciesAchieved" placeholder="0">
          <span class="input-group-text">(other partners)</span>
        </div>
      </div>
      </div>
        <div class="col-md-3">
        <div class="form-group mb-2">
          <label for="chromosomeAnalysis">Chromosome analysis</label>
          <select class="form-select" id="chromosomeAnalysis" formControlName="chromosomeAnalysis">
            <option value="" disabled selected>Select analysis</option>
            <option *ngFor="let o of opts('IVFFertilityHistory:ChromosomeAnalysis')" [value]="o.valueId">{{ o.name }}</option>
          </select>
        </div>
      </div>
      <div class="col-md-3">
        <div class="form-group mb-2">
          <label for="cftrCarrier">CFTR carrier</label>
          <select class="form-select" id="cftrCarrier" formControlName="cftrCarrier">
            <option value="" disabled selected>Select carrier status</option>
            <option *ngFor="let o of opts('IVFFertilityHistory:CFTRCarrier')" [value]="o.valueId">{{ o.name }}</option>
          </select>
        </div>
      </div>
    </div>
    <!-- ========== TOP SIDE END ========== -->

    <div class="row g-2">
      <!-- ========== PREVIOUS ILLNESSES (DROPDOWN MULTI-SELECT) START ========== -->
      <div class="col-md-6">
        <div class="card px-3 py-2">
          <div class="form-group">
            <label class="d-block fw-bold mb-1">Previous illnesses</label>
            <div class="dropdown w-100">
              <button class="form-select text-start dropdown-toggle d-flex justify-content-between align-items-center" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                <span class="text-truncate">
                  <span *ngIf="selectedIllnesses.length === 0" class="text-muted">Select illnesses...</span>
                  <span *ngIf="selectedIllnesses.length > 0">{{ selectedIllnesses.join(', ') }}</span>
                </span>
                <i class="bi bi-caret-down-fill ms-2"></i>
              </button>
              <ul class="dropdown-menu w-100" data-bs-auto-close="outside">
                <li class="px-2 py-1 sticky-top bg-white" style="z-index: 10;">
                  <input type="text" class="form-control form-control-sm" placeholder="Search..." [ngModel]="searchIllness" (ngModelChange)="onIllnessSearchChange($event)" [ngModelOptions]="{standalone: true}">
                </li>
                <li><hr class="dropdown-divider m-0"></li>
                <li>
                  <div style="max-height: 260px; overflow: auto;" (scroll)="onIllnessScroll($event)">
                    <div *ngFor="let opt of filteredIllnessesOptions" class="px-2 py-1">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" [checked]="isSelected(opt)" (click)="$event.stopPropagation()" (change)="toggleIllness(opt)">
                        <label class="form-check-label" (click)="$event.preventDefault(); $event.stopPropagation(); toggleIllness(opt)">{{ opt }}</label>
                      </div>
                    </div>
                  </div>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
      <!-- ========== PREVIOUS ILLNESSES (DROPDOWN MULTI-SELECT) END ========== -->

      <!-- ========== FERTILITY IMPAIRMENT FACTORS (DROPDOWN MULTI-SELECT) START ========== -->
      <div class="col-md-6">
        <div class="card px-3 py-2">
          <div class="form-group">
            <label class="d-block fw-bold">Fertility impairment factors</label>
            <div class="dropdown w-100">
              <button class="form-select text-start dropdown-toggle d-flex justify-content-between align-items-center" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                <span class="text-truncate">
                  <span *ngIf="selectedFactors.length === 0" class="text-muted">Select factors...</span>
                  <span *ngIf="selectedFactors.length > 0">{{ selectedFactors.join(', ') }}</span>
                </span>
                <i class="bi bi-caret-down-fill ms-2"></i>
              </button>
              <ul class="dropdown-menu w-100" data-bs-auto-close="outside">
                <li class="px-2 py-1 sticky-top bg-white" style="z-index: 10;">
                  <input type="text" class="form-control form-control-sm" placeholder="Search..." [ngModel]="searchFactor" (ngModelChange)="onFactorSearchChange($event)" [ngModelOptions]="{standalone: true}">
                </li>
                <li><hr class="dropdown-divider m-0"></li>
                <li>
                  <div style="max-height: 260px; overflow: auto;" (scroll)="onFactorScroll($event)">
                    <div *ngFor="let opt of filteredFactorsOptions" class="px-2 py-1">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" [checked]="isFactorSelected(opt)" (click)="$event.stopPropagation()" (change)="toggleFactor(opt)">
                        <label class="form-check-label" (click)="$event.preventDefault(); $event.stopPropagation(); toggleFactor(opt)">{{ opt }}</label>
                      </div>
                    </div>
                  </div>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
      <!-- ========== FERTILITY IMPAIRMENT FACTORS (DROPDOWN MULTI-SELECT) END ========== -->
    </div>

    <!-- ========== SEMEN ANALYSIS SECTION START ========== -->
    <div class="card px-3 py-2 mb-0">
      <div class="d-flex justify-content-between align-items-center">
        <label class="fw-bold">Basis semen analysis</label>
        <button type="button" class="btn btn-sm btn-primary" (click)="addAnalysis()">
          <i class="bi bi-plus-lg"></i> Add semen analysis
        </button>
      </div>
      <div class="mt-2" formArrayName="analyses">
        <div class="card px-3 py-2 mb-2" *ngFor="let a of analyses.controls; let i = index" [formGroupName]="i">
          <div class="d-flex justify-content-between align-items-center mb-1">
            <h6 class="mb-0">Analysis {{ i + 1 }}</h6>
            <button type="button" class="btn btn-sm btn-outline-danger" (click)="removeAnalysis(i)" *ngIf="analyses.length > 1">
              <i class="bi bi-trash"></i> Remove
            </button>
          </div>

          <div class="row g-1">
            <div class="col-md-3">
              <label class="small">Date</label>
              <input type="date" class="form-control" formControlName="date">
            </div>
            <div class="col-md-3">
              <label class="small">ID</label>
              <input type="number" class="form-control" formControlName="id" placeholder="ID">
            </div>
            <div class="col-md-3">
              <label class="small">#Motile</label>
              <div class="input-group">
                <input type="number" class="form-control" formControlName="motile" placeholder="#">
                <span class="input-group-text">#</span>
              </div>
            </div>
          <!-- </div>

          <div class="row g-2 mt-1"> -->
            <div class="col-md-3">
              <label>Collection method</label>
              <input type="text" class="form-control" formControlName="collectionMethod" placeholder="Enter method">
            </div>
          </div>

          <div class="row mb-2 mt-2">
            <div class="col-6"></div>
            <div class="col-3 text-center">
              <span class="fw-bold">Native</span>
            </div>
            <div class="col-3 text-center">
              <span class="fw-bold">After prep.</span>
            </div>
          </div>

          <div class="row mb-2">
            <div class="col-6">
              <label>Concentration [10‚Å∂/ml]</label>
            </div>
            <div class="col-3">
              <input type="number" class="form-control form-control-sm" formControlName="concentrationNative" placeholder="0">
            </div>
            <div class="col-3">
              <input type="number" class="form-control form-control-sm" formControlName="concentrationAfterPrep" placeholder="0">
            </div>
          </div>

          <div class="row mb-2">
            <div class="col-6">
              <label>Overall motility [%]</label>
            </div>
            <div class="col-3">
              <input type="number" class="form-control form-control-sm" formControlName="overallMotilityNative" placeholder="0">
            </div>
            <div class="col-3">
              <input type="number" class="form-control form-control-sm" formControlName="overallMotilityAfterPrep" placeholder="0">
            </div>
          </div>

          <div class="row mb-2">
            <div class="col-6">
              <label>Progressive motility [%]</label>
            </div>
            <div class="col-3">
              <input type="number" class="form-control form-control-sm" formControlName="progressiveMotilityNative" placeholder="0">
            </div>
            <div class="col-3">
              <input type="number" class="form-control form-control-sm" formControlName="progressiveMotilityAfterPrep" placeholder="0">
            </div>
          </div>

          <div class="row mb-2">
            <div class="col-6">
              <label>Normal forms [%]</label>
            </div>
            <div class="col-3">
              <input type="number" class="form-control form-control-sm" formControlName="normalFormsNative" placeholder="0">
            </div>
            <div class="col-3">
              <input type="number" class="form-control form-control-sm" formControlName="normalFormsAfterPrep" placeholder="0">
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- ========== SEMEN ANALYSIS SECTION END ========== -->
</div>
