<!-- ðŸ”¹ Breadcrumb OUTSIDE card -->
<nav aria-label="breadcrumb">
  <ol class="breadcrumb bg-light bg-opacity-50 p-2 mb-3">
    <li class="breadcrumb-item">
      <a href="javascript:void(0);">
        <ng-icon name="tablerSmartHome"></ng-icon>
        Clinical
      </a>
    </li>
    <li class="d-flex align-items-center text-muted mx-1" aria-current="page">
      <ng-icon name="tablerChevronRight"></ng-icon>
    </li>
    <li class="breadcrumb-item active" aria-current="page">Problem list</li>
  </ol>
</nav>

<!-- ðŸ”¹ Tabs INSIDE card -->
<div class="card shadow rounded">
  <div class="card-body">

    <!-- Tabs -->
    <ul ngbNav #nav="ngbNav" [(activeId)]="activeTabId" class="nav nav-tabs mb-3">
      <!-- Problem Tab -->
      <li [ngbNavItem]="1">
        <a ngbNavLink href="javascript:void(0)">Problem</a>
        <ng-template ngbNavContent>
          <!-- <app-problem-list></app-problem-list> -->


          <form [formGroup]="medicalForm" (ngSubmit)="onSubmit()">
            <div class="card p-3 shadow rounded">
              <!-- FORM SECTION -->
              <!-- <div class="row">
              <div class="col-12" style="margin-top: -20px;">
                <div class="form-check">
                  <input type="checkbox" class="form-check-input" formControlName="isProviderCheck" id="isProviderCheck"
                    (change)="onCheckboxChange()" style="height: 20px; width: 20px;" />
                  <label class="form-check-label" for="isProviderCheck" style="margin-bottom: -22px;">
                    Provider Outside Clinic
                  </label>
                </div>
              </div>
            </div> -->

              <div class="row mt-2">
                <div class="col-12" style="margin-top: -20px;">
                  <div class="form-check">
                    <input type="checkbox" class="form-check-input" formControlName="isProviderCheck"
                      id="isProviderCheck"  style="height: 20px; width: 20px;" />
                    <label class="form-check-label fw-semibold" for="isProviderCheck"
                      style="margin-left: 5px; margin-top: 3px;">
                      Provider Outside Clinic
                    </label>
                  </div>
                </div>
              </div>

              <div class="row mt-2">
                <div class="col-lg-3">
                  <div class="mb-3">
                    <label class="form-label fw-semibold">Provider</label>
                    <select class="form-select" formControlName="providerId">
                      <option [ngValue]="null" disabled>Select Provider</option>
                      <option *ngFor="let provider of hrEmployees" [value]="provider.providerId">{{ provider.name }}
                      </option>
                    </select>
                  </div>
                </div>


                <div class="col-lg-3">
                  <div class="mb-3">
                    <label class="form-label" >Problem</label>

                    <div class="input-group">
                      <input type="text" class="form-control" formControlName="problem" placeholder="Enter problem" />
                      <button class="btn btn-success" type="button" (click)="ClickFilter(standardModal)">
                        <i class="fa fa-search"></i>
                      </button>
                    </div>
                    <!-- Problem input with search button -->
                    <!-- <div class="input-group">
                      <input type="text" formControlName="problem" class="form-control"  placeholder="Problem" />
                      <button type="button" class="btn btn-outline-primary" (click)="ClickFilter(standardModal)">
                        <i class="bi bi-search"></i>
                      </button>
                    </div> -->


                  </div>
                </div>



                <div class="col-lg-3">
                  <div class="mb-3">
                    <label class="form-label">Comments</label>
                    <input type="text" class="form-control" formControlName="comments" placeholder="Enter comments" />
                  </div>
                </div>

                <!-- <div class="col-md-3 col-sm-4 col-12 checkbox-container mb-3">
                  <div class="form-check">
                    <input type="checkbox" class="form-check-input" formControlName="confidential"
                      id="confidentialCheck" />
                    <label class="form-check-label" for="confidentialCheck">Confidential</label>
                  </div>
                </div> -->
                <div class="col-lg-3">
                  <div class="mb-3">
                    <input type="checkbox" class="form-check-input" formControlName="confidential"
                      id="confidentialCheck" />
                    <label class="form-check-label" for="confidentialCheck">Confidential</label>
                  </div>
                </div>

                <div class="col-lg-3">
                  <div class="mb-3">
                    <label class="form-label">Status</label>
                    <select class="form-select" formControlName="status" >
                      <option value="" disabled selected>Select Status</option>
                      <option value="Active">Active</option>
                      <option value="Inactive">Inactive</option>
                    </select>
                  </div>
                </div>

                <div class="col-lg-3">
                  <div class="mb-3">
                    <label class="form-label">Start Date</label>
                    <input type="date" class="form-control" formControlName="startDate" />
                  </div>
                </div>

                <div class="col-lg-3">
                  <div class="mb-3">
                    <label class="form-label">End Date</label>
                    <input type="date" class="form-control" formControlName="endDate" />
                  </div>
                </div>

                <div class="col-lg-3 ms-auto">
                  <div class="d-flex justify-content-end gap-2 mt-8">

                    <button type="button" class="btn btn-secondary" (click)="onClear()">Clear</button>
                    <button type="submit" class="btn btn-success">Save</button>
                  </div>
                </div>
              </div>
            </div>
          </form>

        </ng-template>
      </li>

      <!-- Favorites Tab -->
      <li [ngbNavItem]="2">
        <a ngbNavLink href="javascript:void(0)">Favorites</a>
        <ng-template ngbNavContent>
          <!-- <app-favorites></app-favorites> -->

          <!-- ad waleed -->
          <form [formGroup]="favoritesForm">
            <div class="card p-3 shadow rounded">

              <div class="row align-items-end">
                <!-- ICD Version Dropdown -->
                <div class="col-lg-3">
                  <div class="mb-3">
                    <label class="form-label">ICD Versions:</label>
                    <select class="form-select" formControlName="icdVersion">
                      <option value="">ALL</option>
                      <option *ngFor="let version of icdVersionList" [value]="version">{{ version }}</option>
                    </select>
                  </div>
                </div>

                <!-- Search Code -->
                <div class="col-lg-3">
                  <div class="mb-3">
                    <label class="form-label">Search Code:</label>
                    <input type="text" class="form-control" formControlName="searchCode"
                      placeholder="Search Code / Description" />
                  </div>
                </div>

                <!-- Starting Code -->
                <div class="col-lg-3">
                  <div class="mb-3">
                    <label class="form-label">Starting Code:</label>
                    <input type="text" class="form-control" formControlName="startingCode"
                      placeholder="Starting Code" />
                  </div>
                </div>

                <!-- Search Button -->
                <div class="col-lg-3">
                  <div class="mb-3">
                    <button type="button" class="btn btn-primary" (click)="onSearch()">Search</button>
                  </div>
                </div>
              </div>

              <!-- Results Table -->
              <div class="table-responsive mt-3">
                <table class="table table-bordered table-striped mb-0">
                  <thead>
                    <tr class="text-center">
                      <th>Code</th>
                      <th>ICD Version</th>
                      <th>Description</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngIf="searchResults.length === 0">
                      <td colspan="3" class="text-center">No Diagnosis Code found.</td>
                    </tr>
                    <tr *ngFor="let result of searchResults">
                      <td>{{ result.code }}</td>
                      <td>{{ result.icdVersion }}</td>
                      <td>{{ result.description }}</td>
                    </tr>
                  </tbody>
                </table>
              </div>

            </div>
          </form>


        </ng-template>
      </li>
    </ul>

    <!-- Tab Content -->
    <div [ngbNavOutlet]="nav"></div>

  </div>

  <!-- <div class="table-responsive">
    <table class="table table-bordered table-striped">
      <thead>
        <tr class="text-center">
          <th>Provider</th>
          <th>Problem</th>
          <th>Comments</th>
          <th>Confidential</th>
          <th>Status</th>
          <th>Start Date</th>
          <th>End Date</th>
          <th class="text-center">Action</th>
        </tr>
      </thead>
      <tbody class="table-group-divider">
        <tr *ngFor="let record of medicalHistoryData">
          <td>{{ record.provider }}</td>
          <td>{{ record.problem }}</td>
          <td>{{ record.comments }}</td>
          <td class="text-center">
            <ng-icon [name]="record.confidential ? 'tablerCheck' : 'tablerX'"></ng-icon>
          </td>
          <td>{{ record.status }}</td>
          <td>{{ record.startDate }}</td>
          <td>{{ record.endDate }}</td>
        
           <div ngbDropdownMenu class="dropdown-menu-end d-flex gap-2 px-2 py-1">
                  <ng-icon name="tablerEdit" class="me-1" (click)="editproblem(record)">
                  </ng-icon>
                  <ng-icon name="tablerTrash" class="text-danger me-1" (click)="
                                           deleteproblem(record.id) ">
                  </ng-icon>
                </div>
          

        </tr>
      </tbody>
    </table>
  </div>
  <app-generic-pagination
  [totalItems]="problemTotalItems"
  [pageSize]="problemPageSize"
  [currentPage]="problemCurrentPage"
  (pageChanged)="onProblemPageChanged($event)">
</app-generic-pagination> -->
<div class="card mt-3">
  <div class="card-body">
    <div class="table-responsive">
      <table class="table align-middle mb-0">
        <thead class="align-middle thead-sm">
          <tr>
            <th class="text-center">Provider</th>
            <th class="text-center">Problem</th>
            <th class="text-center">Comments</th>
            <th class="text-center">Confidential</th>
            <th class="text-center">Status</th>
            <th class="text-center">Start Date</th>
            <th class="text-center">End Date</th>
            <th class="text-center">Action</th>
          </tr>
        </thead>
        <tbody class="table-group-divider">
          <tr *ngFor="let record of medicalHistoryData">
            <td class="text-center">{{ record.provider }}</td>
            <td class="text-center">{{ record.problem }}</td>
            <td class="text-center">{{ record.comments }}</td>
            <td class="text-center">
              <ng-icon [name]="record.confidential ? 'tablerCheck' : 'tablerX'"></ng-icon>
            </td>
            <td class="text-center">{{ record.status }}</td>
            <td class="text-center">{{ record.startDate }}</td>
            <td class="text-center">{{ record.endDate }}</td>
            <td class="text-center">
              <div ngbDropdownMenu class="dropdown-menu-end d-flex gap-2 px-2 py-1">
                <ng-icon name="tablerEdit" class="me-1" (click)="editproblem(record)"></ng-icon>
                <ng-icon name="tablerTrash" class="text-danger me-1" (click)="deleteproblem(record.id)"></ng-icon>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <app-generic-pagination
      [totalItems]="problemTotalItems"
      [pageSize]="problemPageSize"
      [currentPage]="problemCurrentPage"
      (pageChanged)="onProblemPageChanged($event)">
    </app-generic-pagination>
  </div>
</div>



</div>



<ng-template #standardModal let-modal>
  <form [formGroup]="FilterForm" (ngSubmit)="SearchDiagnosis()">
    <div class="modal-header">
      <h5 class="modal-title">Search-Problem</h5>
      <button type="button" class="btn-close" (click)="modal.dismiss()"></button>
    </div>

    <div class="modal-body">
      <div class="card shadow-sm rounded-3">
        <div class="card-body">
          <div class="container-fluid">
            <div class="row g-3">
              <!-- ICD Version -->
              <div class="col-md-4 col-sm-12">
                <label for="icdVersionId" class="form-label">ICD Versions:</label>
                <select class="form-control" formControlName="icdVersionId" id="icdVersionId" required>
                  <option value="">Select ICD Version</option>
                  <option *ngFor="let version of ICDVersions" [value]="version.code">
                    {{ version.name }}
                  </option>
                </select>
              </div>

              <!-- Search Code -->
              <div class="col-md-4 col-sm-12">
                <label for="searchById" class="form-label">Search Code:</label>
                <select class="form-control" formControlName="searchById" id="searchById" required
                  (change)="onSearchByChange()">
                  <option value="">Select Option</option>
                  <option *ngFor="let item of Searchby" [value]="item.code">
                    {{ item.name }}
                  </option>
                </select>
              </div>

              <!-- Starting Code -->
              <div class="col-md-4 col-sm-12" *ngIf="FilterForm.value.searchById != 3">
                <label for="startingCode" class="form-label">Starting Code:</label>
                <input type="text" class="form-control" formControlName="startingCode" id="startingCode"
                  placeholder="Enter Starting Code" />
              </div>

              <!-- Ending Code -->
              <div class="col-md-4 col-sm-12" *ngIf="FilterForm.value.searchById == 2">
                <label for="diagnosisEndCode" class="form-label">Ending Code:</label>
                <input type="text" class="form-control" formControlName="diagnosisEndCode" id="diagnosisEndCode"
                  placeholder="Enter Ending Code" />
              </div>

              <!-- Description -->
              <div class="col-md-4 col-sm-12" *ngIf="FilterForm.value.searchById == 3">
                <label for="Description" class="form-label">Description:</label>
                <input type="text" class="form-control" formControlName="descriptionFilter" id="Description"
                  placeholder="Enter Description" />
              </div>

              <!-- Submit Button -->
              <div class="col-md-2 col-sm-12 mt-3">
                <button class="btn btn-info w-100" type="submit">Search</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- ðŸŸ¦ Diagnosis Code Table (Show Only If Data Exists) -->
      <div class="mt-4" *ngIf="paginatedDiagnosisCode.length > 0">
        <table class="table table-sm table-striped table-bordered text-center align-middle">
          <thead>
            <tr>
              <th style="font-size: 14px">Code</th>
              <th style="font-size: 14px">ICD Version</th>
              <th style="font-size: 14px">Description5</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let diagnosis of paginatedDiagnosisCode" (click)="onRowSelect(diagnosis, modal)">
              <td style="font-size: 12px">{{ diagnosis.icD9Code }}</td>
              <td style="font-size: 12px">{{ diagnosis.icdVersion }}</td>
              <td style="font-size: 12px">{{ diagnosis.descriptionFull }}</td>
            </tr>
          </tbody>
        </table>

        <!-- Pagination -->
        <!-- <nav *ngIf="DiagnosisCode.length > pageSize">
          <ul class="pagination justify-content-center">
            <li class="page-item" [class.disabled]="currentPageDiagnoseCode === 1">
              <a class="page-link" (click)="goToPage(currentPageDiagnoseCode - 1)">Previous</a>
            </li>
            <li class="page-item"
                *ngFor="let page of totalDiagnosisData; let i = index"
                [class.active]="i + 1 === currentPageDiagnoseCode">
              <a class="page-link" (click)="goToPage(i + 1)">{{ i + 1 }}</a>
            </li>
            <li class="page-item" [class.disabled]="currentPageDiagnoseCode === totalDiagnosisData.length">
              <a class="page-link" (click)="goToPage(currentPageDiagnoseCode + 1)">Next</a>
            </li>
          </ul>
        </nav> -->
        <nav *ngIf="DiagnosisCode.length > pageSize">
          <ul class="pagination justify-content-center flex-wrap">
            <li class="page-item" [class.disabled]="currentPageDiagnoseCode === 1">
              <a class="page-link" (click)="goToPage(currentPageDiagnoseCode - 1)">Previous</a>
            </li>

            <li class="page-item" *ngFor="let page of totalPagesDiagnoseCode"
              [class.active]="page === currentPageDiagnoseCode">
              <a class="page-link" (click)="goToPage(page)">{{ page }}</a>
            </li>

            <li class="page-item" [class.disabled]="currentPageDiagnoseCode === totalPagesDiagnoseCode.length">
              <a class="page-link" (click)="goToPage(currentPageDiagnoseCode + 1)">Next</a>
            </li>
          </ul>
        </nav>

      </div>

      <!-- Empty Message -->
      <div *ngIf="paginatedDiagnosisCode.length === 0  &&  DiagnosisSearched" class="text-center mt-3 text-muted">
        No Diagnosis Code found.
      </div>
    </div>

    <div class="modal-footer">
      <button type="button" class="btn btn-light" (click)="modal.dismiss()">Close</button>
      <button type="submit" class="btn btn-primary">Search</button>
    </div>
  </form>
</ng-template>