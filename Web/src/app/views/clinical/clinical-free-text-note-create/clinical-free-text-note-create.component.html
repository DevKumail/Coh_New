<div class="d-flex row col-12 h-100">
<!-- [ngClass]="{
      'col-8': dataquestion?.node?.noteTitle,
      'col-12': !dataquestion?.node?.noteTitle
    }"  -->
    <div class="card  mt-2 d-flex flex-column">
    <form [formGroup]="clinicalForm" (ngSubmit)="submitVoice()">
  <div class="card-header d-flex justify-content-between align-items-center">
      <div class="d-flex align-items-center">
    <label class="form-label mb-0 me-2" style="font-size: 0.875rem; font-weight: 600;">
      Note Title
    </label>
    <input type="text"
           class="form-control form-control-sm"
           style="width: 300px; font-size: 0.875rem; background-color: #e9ecef; cursor: not-allowed;"
           [value]="dataquestion?.node?.noteTitle || ('CLINICAL_FREE_TEXT_NOTE' | translate)"
           readonly
           disabled>
  </div>

  <!-- Description -->
  <div class="d-flex align-items-center">
    <label class="form-label mb-0 me-2" style="font-size: 0.875rem;">
      Description
    </label>
    <textarea class="form-control"
              style="width: 300px; height: 42px; font-size: 0.875rem;"
              placeholder="Description"
              formControlName="description">
    </textarea>
  </div>


         <div class="row">
          <div class="col-12 d-flex justify-content-end gap-2">
              <button class="btn btn-danger"
               (click)="cancel()" type="button">{{ 'CANCEL' | translate }}</button>
            <button class="btn btn-info" [disabled]="clinicalForm.invalid" type="submit">{{ 'SAVE' | translate }}</button>
          </div>
        </div>

  </div>

  <div class="card-body flex-grow-1 overflow-auto">
      <div >
        <div class="row g-3 mb-2">
          <div [class]="hideTemplateDropdown ? 'col-sm-4 col-md-3' : 'col-sm-3'">
            <label class="form-label">Provider (For Signing) <span class="text-danger">*</span></label>
            <select class="form-select" formControlName="provider"
              (change)="onProviderchange()">
              <option value="null" disabled>Select Provider</option>
              <option *ngFor="let p of providers" [value]="p.code">{{ p.name }}</option>
            </select>
          </div>
          <div class="voice-controls">
      <button
        type="button"
        class="btn"
        [ngClass]="isRecording ? 'btn-danger' : 'btn-primary'"
        (click)="toggleVoiceRecording()"
        [disabled]="!clinicalForm.get('provider')?.value">
        <i class="fas" [ngClass]="isRecording ? 'fa-stop' : 'fa-microphone'"></i>
        {{ isRecording ? 'Stop Recording' : 'Start Voice Transcription' }}
      </button>
      <span *ngIf="isRecording" class="recording-indicator">
        <i class="fas fa-circle text-danger blink"></i> Recording...
      </span>
    </div>



        </div>
      </div>

    <!-- Editable Template Content -->
    <div class="mt-3" *ngIf="dataquestion?.node?.noteTitle">
      <div class="card p-3">
        <div contenteditable="true" class="editable-title">
          <h2 class="fw-bold text-decoration-underline">{{ dataquestion?.node?.noteTitle }}</h2>
        </div>
        <div *ngFor="let q of dataquestion?.node?.questions" class="mt-2">
          <div contenteditable="true" class="editable-question">
            <app-question-view [question]="q"></app-question-view>
          </div>
        </div>
      </div>
    </div>

    <!-- Free Text Editor when no template -->
    <div class="mt-3" *ngIf="!dataquestion?.node?.noteTitle">
      <div class="card px-3 py-2">
        <label class="fw-bold mb-2">Clinical Note Editor</label>
        <quill-editor
          formControlName="editorContent"
          [modules]="quillModules"
          format="html"
          [style.height]="'300px'">
        </quill-editor>
      </div>
    </div>

    <!-- Add this button near your editor or toolbar -->


  </div> <!-- card-body -->
</form>

</div> <!-- card -->

</div>

<style>
  .editable-title, .editable-question {
    outline: none;
    border: 1px dashed transparent;
    padding: 8px;
    border-radius: 4px;
    transition: all 0.2s;
  }

  .editable-title:hover, .editable-question:hover {
    border-color: #0d6efd;
    background-color: #f8f9fa;
  }

  .editable-title:focus, .editable-question:focus {
    border-color: #0d6efd;
    background-color: #ffffff;
    box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.1);
  }

  /* Additional styles for the updated layout */
  .voice-controls {
    margin-top: 10px;
    display: flex;
    align-items: center;
  }

  .voice-btn {
    margin-right: 10px;
  }

  .recording-indicator {
    display: flex;
    align-items: center;
  }

  .recording-pulse {
    animation: pulse-animation 1.5s infinite;
  }

  @keyframes pulse-animation {
    0% {
      transform: scale(1);
    }
    50% {
      transform: scale(1.1);
    }
    100% {
      transform: scale(1);
    }
  }

  .clinical-note-editor-wrapper {
    margin-top: 10px;
  }

  .editor-header {
    background-color: #f1f3f5;
    padding: 10px;
    border-radius: 4px 4px 0 0;
  }

  .editor-container {
    border: 1px solid #ced4da;
    border-radius: 0 0 4px 4px;
    overflow: hidden;
  }
</style>
