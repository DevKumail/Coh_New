<div>
  <div class="row mb-3">
    <div class="col-12 col-md-6">
      <label class="form-label">Select documents</label>
      <input type="file" class="form-control" multiple (change)="onFilesChosen($event)" />
      <div class="form-text">Choose one or more files. They will appear in the Selected list below.</div>
    </div>
  </div>

  <div class="card">
    <div class="card-body">
      <!-- Loading skeletons -->
      <div *ngIf="isLoading" class="d-flex flex-wrap gap-3">
        <div *ngFor="let i of [1,2,3]" class="placeholder-glow" style="width: 160px;">
          <div class="placeholder w-100 mb-2" style="height: 100px;"></div>
          <div class="placeholder w-75 mb-1"></div>
          <div class="placeholder w-50"></div>
        </div>
      </div>

      <!-- Thumbnail style attachments -->
      <div *ngIf="!isLoading && selected.length" class="d-flex flex-wrap gap-2">
        <div
          *ngFor="let d of selected"
          class="attachment-card d-flex flex-column border rounded-3 shadow-sm"
          style="width: 140px; overflow: hidden; background-color: var(--bs-body-bg);">

          <!-- Thumbnail / icon -->
          <div class="bg-light d-flex align-items-center justify-content-center" style="height: 80px;">
            <ng-container *ngIf="getPreview(d) as url; else fileIcon">
              <img
                [src]="url"
                alt="thumb"
                style="max-width: 100%; max-height: 100%; object-fit: cover;" />
            </ng-container>
            <ng-template #fileIcon>
              <ng-container *ngIf="d.ext === 'pdf'; else docBadge">
                <span class="badge bg-danger px-3 py-2 rounded-2">PDF</span>
              </ng-container>
              <ng-template #docBadge>
                <ng-container *ngIf="d.ext === 'doc' || d.ext === 'docx'; else xlsBadge">
                  <span class="badge bg-info px-3 py-2 rounded-2">DOCX</span>
                </ng-container>
              </ng-template>
              <ng-template #xlsBadge>
                <ng-container *ngIf="d.ext === 'xls' || d.ext === 'xlsx'; else pptBadge">
                  <span class="badge bg-success px-3 py-2 rounded-2">XLSX</span>
                </ng-container>
              </ng-template>
              <ng-template #pptBadge>
                <ng-container *ngIf="d.ext === 'ppt' || d.ext === 'pptx'; else genericBadge">
                  <span class="badge bg-warning text-dark px-3 py-2 rounded-2">PPTX</span>
                </ng-container>
              </ng-template>
              <ng-template #genericBadge>
                <span class="badge bg-secondary px-3 py-2 rounded-2">
                  {{ (d.ext || '-') | uppercase }}
                </span>
              </ng-template>
            </ng-template>
          </div>

          <!-- Meta info -->
          <div class="p-2 d-flex flex-column flex-grow-1">
            <div class="small fw-semibold text-truncate" [title]="d.name">
              {{ d.name }}
            </div>
            <div class="text-muted small">
              {{ d.size | number }} B Â· {{ d.ext || '-' }}
            </div>

            <div class="mt-2 d-flex justify-content-end">
              <button
                type="button"
                class="btn btn-link text-danger btn-sm p-0"
                [title]="d.isExisting ? 'Delete from server' : 'Remove from selection'"
                (click)="removeOne(d.id)">
                {{ d.isExisting ? 'Delete' : 'Remove' }}
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Empty state -->
      <div *ngIf="!isLoading && !selected.length" class="text-muted small">
        No documents selected.
      </div>
    </div>
  </div>
</div>
